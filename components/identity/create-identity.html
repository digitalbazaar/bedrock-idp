<div class="ng-cloak" ng-controller="CreateIdentityController as model">

<div class="row">
  <div class="col-md-12">
    <br-demo-warning></br-demo-warning>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <h1 class="headline">Create an Identity</h1>
  </div>
</div>

<div class="row">
  <div class="col-md-offset-2 col-md-8">

    <form name="regForm" class="form-horizontal" ng-submit="model.submit()">
      <fieldset>
        <legend>Your Email and Password</legend>

        <div class="form-group">
          <p class="help-block col-md-10">
            By entering a valid email address and password you will be able to
            log into the service.
          </p>
        </div>

        <br-input br-model="model.identity.email"
          br-options="{
            name: 'email', label: 'Email', disabled: {{model.loading}},
            autocomplete: 'off',
            columns: {
              label: 'col-md-3',
              input: 'col-md-7',
              help: 'col-md-offset-3 col-md-7'
            }
          }">
          A valid email address is required so that we can reset
          your password if you get locked out.
        </br-input>
        <div ng-show="model.identity.email" class="form-group">
          <div class="col-md-offset-3 col-md-7"
            br-duplicate-checker="model.identity.email"
            br-duplicate-checker-type="email"
            br-duplicate-checker-available="This email address is available!"
            br-duplicate-checker-invalid="Email address is invalid."
            br-duplicate-checker-taken="This email address is already in use. While you can create a new identity if you want to, you may want to log in as your existing identity instead."
            br-duplicate-checker-checking="Checking Availability..."
            br-duplicate-checker-result="model.emailAvailable">
          </div>
        </div>

        <br-input br-model="model.identity.sysPassword"
          br-options="{
            name: 'sysPassword', type: 'password',
            label: 'Password', disabled: {{model.loading}},
            showValidation: true,
            columns: {
              label: 'col-md-3',
              input: 'col-md-7',
              help: 'col-md-offset-3 col-md-7'
            }
          }" ng-minlength="6" ng-maxlength="32" required>
          <br-input-help>
            Please enter a secure password that is between 6 and 32 characters long. The best passwords are
            lengthy, memorable phrases like: the<strong>lemurs</strong>ride<strong>on</strong>the<strong>fortnight</strong>
          </br-input-help>
          <br-input-validation-errors>
            <p ng-show="regForm.sysPassword.$error.required">
              Password is required.
            </p>
            <p ng-show="regForm.sysPassword.$error.minlength">
              Password is required to be at least 6 characters.
            </p>
            <p ng-show="regForm.sysPassword.$error.maxlength">
              Password must not be longer than 32 characters.
            </p>
          </br-input-validation-errors>
        </br-input>

        <br-input br-model="model.passphraseConfirmation"
          br-options="{
            name: 'passphraseConfirmation', type: 'password',
            label: 'Confirm Password', disabled: {{model.loading}},
            showValidation: true,
            columns: {
              label: 'col-md-3',
              input: 'col-md-7',
              help: 'col-md-offset-3 col-md-7'
            }
          }" br-input-br-passphrase-confirmation="model.identity.sysPassword">
          <br-input-help>
            Please confirm your password.
          </br-input-help>
          <br-input-validation-errors>
            <p ng-show="regForm.passphraseConfirmation.$error.inputMatch">
              Password and Confirm Password must match.
            </p>
          </br-input-validation-errors>
        </br-input>
      </fieldset>

      <br/>

      <fieldset>
        <legend>Your Identity</legend>

        <div class="form-group">
          <p class="help-block col-md-10">
            Your identity will be used to keep track of and verify your online
            activity with this service. Please enter your full name and then
            select a short name that is used for your identity.  It is usually
            a good idea to use some shortened form of your full name for your
            id, similar to how people choose email addresses or Twitter
            handles.
          </p>
        </div>

        <br-input br-model="model.identity.label"
          br-options="{
            name: 'label', label: 'Full Name',
            placeholder: 'My Full Name', disabled: {{model.loading}},
            autocomplete: 'off',
            columns: {
              label: 'col-md-3',
              input: 'col-md-7',
              help: 'col-md-offset-3 col-md-7'
            }
          }">
          Enter the full name that is associated with this new identity.
          For instance "My Full Name" or "Mega Corp".
        </br-input>

        <br-input br-model="model.identity.sysSlug"
          ng-model="model.identity.sysSlug"
          br-slug-in="model.identity.label"
          br-options="{
            name: 'sysSlug', label: 'Short Name',
            placeholder: 'my-short-name', disabled: {{model.loading}},
            autocomplete: 'off', maxlength: '32',
            columns: {
              label: 'col-md-3',
              input: 'col-md-7',
              help: 'col-md-offset-3 col-md-7'
            }
          }">
          Enter a short name for this identity. A name similar to your full
          name will help people to identify you. This short name will be
          used in your identity address as shown below. An example would be
          "my-short-name", "myshortname", or "megacorp".
        </br-input>
        <div class="form-group">
          <div class="col-md-offset-3 col-md-7">
            <small>{{model.data.idp.identityBaseUri}}/</small><strong>{{model.identity.sysSlug}}</strong>
          </div>
        </div>
        <div ng-show="model.identity.sysSlug" class="form-group">
          <div class="col-md-offset-3 col-md-7"
            br-duplicate-checker="model.identity.sysSlug"
            br-duplicate-checker-type="identity"
            br-duplicate-checker-available="This identity name is available!"
            br-duplicate-checker-invalid="Identity name is invalid."
            br-duplicate-checker-taken="Identity name has already been taken."
            br-duplicate-checker-checking="Checking Availability..."
            br-duplicate-checker-result="model.identitySlugAvailable">
          </div>
        </div>
      </fieldset>
      <br />
      <br-agreement
        ng-model="model.agreementAccepted"
        br-agreement-group="bedrock-idp.join">
      </br-agreement>
      <hr>
      <div class="form-group">
        <div class="col-md-offset-3">
          <button type="submit"
            ng-disabled="model.loading || model.identitySlugAvailable != 'available' || (model.emailAvailable != 'available' && model.emailAvailable != 'unavailable') || !model.agreementAccepted || regForm.$invalid"
            class="btn btn-primary btn-lg">Create Identity</button>
          <span ng-show="model.loading">
            <i class="fa fa-refresh fa-spin fa-lg"></i>
          </span>
        </div>
      </div>
    </form>

  </div>
</div>

</div>
